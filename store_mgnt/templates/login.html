{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Login â€” StorePro</title>
    <link rel="stylesheet" href="{% static 'css/login.css' %}">
  </head>
  <body>
    {% load static %}
    <div class="page-wrap">
      <div class="login-card" role="main" aria-label="Login card">
        <div class="header">
          <div class="logo">
            <img src="{% static 'images/store_logo.png' %}" alt="Store Logo">
          </div>
          <h1>Welcome back</h1>
          <div class="subtitle">Sign in to your Store Management account</div>
        </div>

        <!-- error message (server can pass ?error=.. to template or view) -->
        {% if error %}
          <div class="error">{{ error }}</div>
        {% endif %}

        <form method="POST" id="loginForm" class="login-form" action="">
          {% csrf_token %}
          <div class="form-row">
            <label for="username">Username</label>
            <input id="username" name="username" class="input" type="text" placeholder="Enter username" autocomplete="username" required>
          </div>

          <div class="form-row pw-wrap">
            <label for="password">Password</label>
            <input id="password" name="password" class="input" type="password" placeholder="Enter your password" autocomplete="current-password" required>
            <!-- button is empty initially; JS will insert the correct SVG -->
            <button type="button" class="pw-toggle" id="pwToggle" aria-label="Show password" title="Show password"></button>
          </div>

          <button class="btn" type="submit">Sign in</button>
        </form>

        <div class="demo-box" aria-hidden="false">
          <div class="demo-title">Demo Accounts</div>
          <div class="demo-sub">Click role to auto-fill login (only username)</div>

          <div class="role-row" id="roleRow">
            <!-- <button class="role-pill" data-role="CEO">CEO</button> -->
            <button class="role-pill" data-role="MANAGER">Manager</button>
            <button class="role-pill" data-role="HR">HR</button>
            <button class="role-pill" data-role="EMPLOYEE">Employee</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      /*
        JS features:
        - show/hide password
        - fetch demo credentials from backend endpoint /demo/credentials/<role>/
        - auto-fill the username/password inputs with backend-provided credentials
      */

      /* show / hide toggle */
      (function(){
  const pw = document.getElementById('password');
  const btn = document.getElementById('pwToggle');

  // SVGs (heroicon-style simplified)
  const eyeOpen = `
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12z"/>
      <circle cx="12" cy="12" r="3"/>
    </svg>`;
  const eyeClosed = `
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <path d="M17.94 17.94A10.94 10.94 0 0 1 12 20c-7 0-11-8-11-8 1.73-3.09 4.22-5.56 7.47-6.62"/>
      <path d="M1 1l22 22"/>
    </svg>`;

  // initial icon = "show" (eye open) because password is hidden initially
    btn.innerHTML = eyeOpen;
    btn.setAttribute('aria-pressed', 'false');

    btn.addEventListener('click', function(e){
        e.preventDefault();
        if (pw.type === 'password') {
        pw.type = 'text';
        btn.innerHTML = eyeClosed;
        btn.setAttribute('aria-label', 'Hide password');
        btn.setAttribute('aria-pressed', 'true');
        } else {
        pw.type = 'password';
        btn.innerHTML = eyeOpen;
        btn.setAttribute('aria-label', 'Show password');
        btn.setAttribute('aria-pressed', 'false');
        }
        // keep focus on the password field after toggle
        pw.focus();
    });

    // keyboard accessibility: allow Enter/Space to toggle
    btn.addEventListener('keydown', function(ev){
        if (ev.key === ' ' || ev.key === 'Enter') {
        ev.preventDefault();
        btn.click();
        }
    });
    })();


      /* demo role buttons - call backend to request real credentials */
      document.getElementById('roleRow').addEventListener('click', async (e) => {
        const btn = e.target.closest('.role-pill');
        if (!btn) return;
        const role = btn.getAttribute('data-role').toLowerCase();

        try {
          // fetch mapping from backend (no auth required)
          const resp = await fetch(`/demo/credentials/${role}/`);
          if (!resp.ok) throw new Error('No mapping found');

          const json = await resp.json();
          // expected JSON: { username: "...", password: "..." }
          document.getElementById('username').value = json.username || '';
          document.getElementById('password').value = json.password || '';
        } catch (err) {
          // fallback to a light client-side fill (if backend not configured)
          // This prevents breaking if endpoint not added. Adjust as you want.
          const fallback = {
            ceo: ['ceo1',''],
            manager: ['manager1','manager123'],
            hr: ['hr1','newhr123'],
            employee: ['arvinder','newpass123']
          };
          const f = fallback[role] || ['', ''];
          document.getElementById('username').value = f[0];
          document.getElementById('password').value = f[1];
        }
      });
    </script>
  </body>
</html>